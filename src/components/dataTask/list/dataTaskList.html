<div>
    <div v-show="showConsole" class="p-2" style="height:300px; overflow-y:auto; background-color:black; color:white ">
        <div v-for="message in consoleMessages">{{ message }}</div>
    </div>

    <v-layout wrap>
        
        <v-flex xs12 class="px-2" v-for="(dataTaskGroup, i) in dataTaskGroups" :key="i">
            <v-card class="mb-3" >
                
                <v-expansion-panel expand>
                    <v-expansion-panel-content style="background-color:#f5f5f5; padding:0 26px" class="py-0" >

                        <v-layout slot="header" row>
                            <v-flex xs2>
                                <v-btn icon flat outline
                                       color="indigo lighten-2 white--text"
                                       title="Execute group"
                                       @click.stop='onExecGroupClick(dataTaskGroup)'><i class="material-icons">alarm</i></v-btn>

                                <v-btn icon flat outline
                                       color="teal lighten-2 white--text"
                                       title="Configure group"
                                       @click.stop='onEditGroupClick(dataTaskGroup)'><v-icon>settings</v-icon></v-btn>
                            </v-flex>
                            <v-flex xs2>
                                <h6>{{dataTaskGroup.Name}}</h6>
                            </v-flex>
                            <v-flex xs3 class="py-3">
                                <span>runs</span> {{cronHumanity(dataTaskGroup.CronSchedule)}}
                            </v-flex>
                            <v-flex xs4 class="py-3">
                                <template v-if="dataTaskGroup.DataTasks.length">
                                    <span>task count:</span> {{dataTaskGroup.DataTasks.length}}
                                </template>
                                <template v-else="dataTaskGroup.DataTasks.length">
                                    <span>no tasks</span>
                                </template>
                            </v-flex>
                            <v-flex xs1 class="text-xs-right pr-4">
                                <v-btn flat icon outline color="primary" dark @click.stop="onDeleteGroup(dataTaskGroup)"><v-icon>delete_forever</v-icon></v-btn>
                            </v-flex>
                        </v-layout>

                        <v-layout row>
                            <v-flex xs12 class="mx-2 px-4">
                                <v-card class="mb-3" v-for="(dataTask, j) in dataTaskGroup.DataTasks" :key="j">
                                    <v-expansion-panel class="task-expansion" expand>
                                        <v-expansion-panel-content style="background-color:#fff" class="">
                                            <v-layout slot="header" row>
                                                <v-flex offset-xs1 xs11 class="mx-2">
                                                    <v-btn icon flat outline
                                                           color="indigo lighten-2 white--text"
                                                           title="Execute task immediately"
                                                           :disabled="dataTask.IsRunning"
                                                           @click.stop='onExecLocalyTaskClick(dataTask)'><i class="material-icons">flash_on</i></v-btn>
                                                    <v-btn icon flat outline
                                                           color="indigo lighten-2 white--text"
                                                           title="Execute task in scheduler"
                                                           :disabled="dataTask.IsRunning"
                                                           @click.stop='onExecInSchTaskClick(dataTask)'><i class="material-icons">alarm</i></v-btn>
                                                    <v-btn icon flat outline
                                                           color="red lighten-2 white--text"
                                                           title="Reset task"
                                                           :disabled="!dataTask.IsRunning"
                                                           @click.stop='onResetTaskClick(dataTask)'><i class="material-icons">flash_off</i></v-btn>
                                                    <v-btn icon flat outline
                                                           color="teal lighten-2 white--text"
                                                           title="Configure task"
                                                           @click.stop='onEditTaskClick(dataTask)'><v-icon>settings</v-icon></v-btn>
                                                    <h6 style="display:inline-block" class="py-3">{{dataTask.DisplayName}}</h6>
                                                    runs {{ cronHumanity(dataTask.CronSchedule) }}
                                                </v-flex>
                                            </v-layout>
                                            <v-layout class="pb-3" row>
                                                <v-flex offset-xs1 xs2 class="px-4" >
                                                    {{ dataTask.DisplayName }}
                                                </v-flex>
                                                <v-flex xs9 class="px-4">
                                                    {{ dataTask.DisplayName }}
                                                </v-flex>
                                            </v-layout>
                                            <v-layout class="pb-3" row>
                                                <v-flex offset-xs1 xs2 class="px-4">
                                                    {{ dataTask.DisplayName }}
                                                </v-flex>
                                                <v-flex xs9 class="px-4">
                                                    {{ dataTask.DisplayName }}
                                                </v-flex>
                                            </v-layout>

                                        </v-expansion-panel-content>
                                    </v-expansion-panel>
                                </v-card>
                            </v-flex>
                        </v-layout>

                    </v-expansion-panel-content>
                </v-expansion-panel>

            </v-card>
        </v-flex>
    </v-layout>

    <!--<v-data-table :headers="vtfGroupGridHeaders"
                  :items="iDataTaskGroups"
                  hide-actions
                  item-key="name">
        <template slot="items" scope="props">
            <tr @click="props.item.dataTaskList.length>0 ? props.expanded = !props.expanded: null">
                <td class="py-3 text-xs-center">{{ props.item.name }}</td>
                <td class="py-3 text-xs-center">{{ props.item.cronSchedule }}</td>
                <td class="py-3 text-xs-center">{{ props.item.dataTaskList.length }}</td>
                <td class="py-3 text-xs-center">{{ props.item.groupOnly }}</td>
            </tr>
        </template>
        <template v-if="props.item.dataTaskList.length" slot="expand" scope="props">
            <v-data-table class="ml-4" :headers="vtfTaskGridHeaders"
                          :items="props.item.dataTaskList"
                          hide-actions
                          item-key="name">
                <template slot="items" scope="props">
                    <td class="text-xs-center" style="width: 1">
                        <v-btn icon flat outline
                               color="indigo lighten-2 white--text"
                               title="Execute task immediately"
                               @click.stop='onExecLocalyTaskClick(DataTask.createDataTaskFromJson(props.item))'><i class="material-icons">flash_on</i></v-btn>
                        <v-btn icon flat outline
                               color="indigo lighten-2 white--text"
                               title="Execute task in scheduler"
                               @click.stop='onExecInSchTaskClick(DataTask.createDataTaskFromJson(props.item))'><i class="material-icons">alarm</i></v-btn>
                        <v-btn icon flat outline
                               color="red lighten-2 white--text"
                               title="Reset task"
                               @click.stop='onResetTaskClick(DataTask.createDataTaskFromJson(props.item))'><i class="material-icons">flash_off</i></v-btn>
                        <v-btn icon flat outline
                               color="teal lighten-2 white--text"
                               title="Configure task"
                               @click.stop='onEditTaskClick(DataTask.createDataTaskFromJson(props.item))'><v-icon>settings</v-icon></v-btn>
                    </td>
                    <td class="py-3 text-xs-center">{{ props.item.displayName }}</td>
                    <td class="py-3 text-xs-center">{{ props.item.cronSchedule }}</td>
                    <td class="py-3 text-xs-center">{{ props.item.status }}</td>
                    <td class="py-3 text-xs-center">{{ formatDate(props.item.lastStartTime) }}</td>
                    <td class="py-3 text-xs-center">{{ formatDate(props.item.nextStartTime) }}</td>
                </template>
            </v-data-table>
        </template>
    </v-data-table>-->

    <div style="overflow-x:auto">
        <b-table id="data-tasks"
                 ref="dataTasksTable"
                 hover
                 no-local-sorting
                 :busy.sync="isBusy"
                 @row-dblclicked="onEditTaskClick"
                 :sort-by.sync="sortBy"
                 :sort-desc.sync="sortDesc"
                 :fields="fieldds"
                 :items="dataTasks">
            <template slot="ExecLoc" scope="data">
                <v-btn icon flat outline
                       color="indigo lighten-2 white--text"
                       title="Execute task immediately"
                       :disabled="data.item.IsRunning"
                       @click='onExecLocalyTaskClick(data.item)'><i class="material-icons">flash_on</i></v-btn>
            </template>
            <template slot="ExecSch" scope="data">
                <v-btn icon flat outline
                       color="indigo lighten-2 white--text"
                       title="Execute task in scheduler"
                       :disabled="data.item.IsRunning"
                       @click='onExecInSchTaskClick(data.item)'><i class="material-icons">alarm</i></v-btn>
            </template>
            <template slot="Reset" scope="data">
                <v-btn icon flat outline
                       color="red lighten-2 white--text"
                       title="Reset task"
                       :disabled="!data.item.IsRunning"
                       @click='onResetTaskClick(data.item)'><i class="material-icons">flash_off</i></v-btn>
            </template>
            <template slot="Config" scope="data">
                <v-btn icon flat outline
                       color="teal lighten-2 white--text"
                       title="Configure task"
                       @click='onEditTaskClick(data.item)'><v-icon>settings</v-icon></v-btn>
            </template>
            <template slot="Delete" scope="data">

                <v-btn flat icon outline color="primary" dark @click.stop="onDeleteTask(data.item)"><v-icon>delete_forever</v-icon></v-btn>

            </template>
        </b-table>
    </div>

    <b-container>
        <b-row class="text-center">
            <b-col class="center">

                <v-btn round
                       title="Add new task"
                       color="teal lighten-2 white--text"
                       @click="onAddDatataskClick"><v-icon class="mr-2">link</v-icon>Add DataTask</v-btn>

                <v-btn round
                       title="Add new group"
                       color="teal lighten-2 white--text"
                       @click="onAddGroupClick"><v-icon class="mr-2">link</v-icon>Add Group</v-btn>

                <v-btn round
                       color="indigo lighten-2 white--text"
                       title="Refresh Table"
                       @click="onRefreshTableClick"><v-icon class="mr-2">autorenew</v-icon>Refresh table</v-btn>

                <v-btn round color="green lighten-2 white--text"
                       @click="showConsole = !showConsole"><v-icon class="mr-2">clear_all</v-icon>Show console</v-btn>

            </b-col>
        </b-row>
    </b-container>

    <edit-task v-model="showEditTask" :dataTask="currentTask" @onClose="closeEditTask"> </edit-task>

    <edit-group v-model="showEditGroup" scope="fromList" :dataTaskGroup="currentGroup" @onClose="closeEditGroup"> </edit-group>

    <execute-task-localy v-model="showExecuteTaskLocaly" :dataTask="currentTask" @onClose="closeExecuteTaskLocaly"> </execute-task-localy>

    <confirmation v-model="showConfirmation"
                  :okCallBack="confirmationCBFunc"
                  :message="confirmationMessage">
    </confirmation>

</div>